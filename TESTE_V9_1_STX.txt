â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        âœ… V9.1 - DPL COM PREFIXO STX CORRETO!            â•‘
â•‘           Agora sim deve funcionar!                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ PROBLEMA ANTERIOR (V9.0):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Comandos DPL foram enviados SEM o prefixo STX (0x02)
Resultado: Impressora imprimiu os comandos como TEXTO!


âœ… CORRIGIDO AGORA (V9.1):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Analisei o hexdump do exemplo.prn e descobri:

COMANDOS COM STX (0x02):
  02 6e 0d 0a           â†’ STX + "n" + CR + LF
  02 4d 31 35...        â†’ STX + "M1500" + CR + LF
  02 4b 63 4c...        â†’ STX + "KcLW0405;" + CR + LF
  02 4f 30 32...        â†’ STX + "O0220" + CR + LF
  02 64 0d 0a           â†’ STX + "d" + CR + LF
  02 49 43 52...        â†’ STX + "ICRsig" + CR

COMANDOS SEM STX:
  31 59 31 31...        â†’ "1Y1100002860072sig" (direto!)
  51 30 30 30 31        â†’ "Q0001" (direto!)
  45 0d 0a              â†’ "E" (direto!)

COMANDOS COM STX DE NOVO:
  02 78 43 47...        â†’ STX + "xCGsig"
  02 7a 43...           â†’ STX + "zC"


ğŸ’¡ PADRÃƒO DESCOBERTO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Comandos de CONFIGURAÃ‡ÃƒO: COM STX (0x02)
- Comandos de EXECUÃ‡ÃƒO (1Y, Q, E): SEM STX
- Comandos de LIMPEZA: COM STX


âœ… IMPLEMENTAÃ‡ÃƒO CORRETA:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```kotlin
fun writeCommand(cmd: String) {
    fullCommand.write(0x02)    // STX
    fullCommand.write(cmd.toByteArray())
}

// Com STX:
writeCommand("n\r\n")
writeCommand("M1500\r\n")
writeCommand("KcLW0405;\r\n")
writeCommand("O0220\r\n")
writeCommand("d\r\n")
writeCommand("ICRsig\r")

// Dados da imagem (sem STX)
fullCommand.write(imageData)

// Sem STX:
fullCommand.write("1Y1100002860072sig\r\n".toByteArray())
fullCommand.write("Q0001\r\n".toByteArray())
fullCommand.write("E\r\n".toByteArray())

// Com STX:
writeCommand("xCGsig\r\n")
writeCommand("zC\r\n")
```


âš¡ TESTE AGORA:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Instalar:
   adb install -r app/build/outputs/apk/debug/app-debug.apk

2. Abrir app â†’ Conectar RP4

3. Desenhar SUA ASSINATURA

4. Clicar "Imprimir"


âœ… DEVE FUNCIONAR AGORA PORQUE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Comandos DPL corretos
âœ“ Prefixos STX nos lugares certos
âœ“ Estrutura EXATA do exemplo.prn
âœ“ Formato de imagem DPL correto


ğŸ¯ RESULTADO ESPERADO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Impressora executa os comandos (nÃ£o imprime como texto)
SUA ASSINATURA aparece como IMAGEM!


ğŸ“Š COMPARAÃ‡ÃƒO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
V9.0: "n\r\n" direto
      â†’ Impressora imprime: n

V9.1: 0x02 + "n\r\n"
      â†’ Impressora executa: Reset


âš¡ TESTE E ME CONTE! ğŸš€

AGORA SIM deve funcionar!
Prefixos STX corretos em todos os comandos!

